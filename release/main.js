/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var k=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var Q=(c,r)=>{for(var s in r)k(c,s,{get:r[s],enumerable:!0})},Z=(c,r,s,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let l of G(r))!J.call(c,l)&&l!==s&&k(c,l,{get:()=>r[l],enumerable:!(i=z(r,l))||i.enumerable});return c};var X=c=>Z(k({},"__esModule",{value:!0}),c);var ie={};Q(ie,{default:()=>A});module.exports=X(ie);var K=require("obsidian");var W=require("obsidian");var O={confirm:"Confirm",yes:"Yes",no:"No",llmLoading:"LLM is thinking...",noResult:"LLM no result",pleaseOpenFile:"Please open a file first",llmError:"An error occurred, please try again later",inputPrompt:"Please enter the prompt",chatButton:"Chat",pleaseSelectText:"Please select the text to be processed first",currentFileNotMarkdown:"The current file is not a markdown file",fileAlreadyContainsTagsAndDescription:"The file already contains tags and description",parseError:"Failed to parse the returned result",metaUpdated:"Meta data updated",noProviderSelected:"No LLM provider selected",llmSettings:"LLM",apiKey:"API key",baseUrl:"Base URL",modelName:"Model name",apiProvider:"API Provider",apiProviderDesc:"Configure your AI provider settings. Custom providers require additional configuration.",llmConfiguration:"API Configuration",selectApiProvider:"Select the API provider",endpoint:"Endpoint",enterEndpoint:"Enter the endpoint for your API",addProvider:"Add Provider",editProvider:"Edit",deleteProvider:"Delete",providerName:"Provider Name",test:"Test",openRouter:"OpenRouter",providerType:"Provider Type",selectProviderType:"Select the type of LLM provider",modelSelection:"Model Selection",selectModel:"Select the model for this provider",currentModel:"Current Model",modelOptions:"Model Options",selectModelFromProvider:"Select a model from the current provider",currentlySelected:"Currently selected",model:"Model",selectTheModelToUse:"Select the model to use",enterYourApiKey:"Enter your API key",show:"Show",hide:"Hide",apiConfig:"API Configuration",customProviderConfig:"Custom Provider Configuration",baseUrlDesc:"Enter the base URL for your custom API endpoint",endpointDesc:"Enter the endpoint for your API",metaUpdateSetting:"Update meta",updateMetaOptions:"Update",updateMetaOptionsDesc:"If it already exists, choose whether to regenerate",updateForce:"Force update existing items",updateNoLLM:"Only update items that do not use LLM",truncateContent:"Truncate long content?",truncateContentDesc:"When using LLM, whether to truncate if the content exceeds the maximum word count",maxContentLength:"Maximum content length",maxContentLengthDesc:"Set the maximum token limit for the content",truncateMethod:"Truncation method",truncateMethodDesc:"Choose how to handle content that exceeds the limit",head_only:"Extract only the beginning",head_tail:"Extract the beginning and the end",heading:"Extract the heading and the text below it",taggingOptions:"Tags",taggingOptionsDesc:"Automatically generating tags",extractTags:"Extract tags",extractTagsDesc:"Extract tags that appear more than twice from all notes and fill them in the candidate box",extract:"Extract",tagList:"Tag list",tagListDesc:"Optional tag list, separated by line breaks",metaTagsPrompt:"Tags Generation Prompt",metaTagsPromptDesc:"The prompt for generating tags, where you can set the language, capitalization, etc.",defaultTagsPrompt:"Please extract up to three tags based on the following article content, and in the same language as the content.",description:"Description",descriptionDesc:"Automatically generating article descriptions",descriptionPrompt:"Prompt",descriptionPromptDesc:"Prompt for generating descriptions",defaultSummaryPrompt:"Summarize the core content of the article directly without using phrases like 'this article.' The summary should be no more than 50 words, and in the same language as the content.",title:"Title",titleDesc:"Automatically generate document titles",enableTitle:"Enable auto title generation",enableTitleDesc:"Enable to automatically generate document titles",titlePrompt:"Title prompt",titlePromptDesc:"Prompt for generating titles",defaultTitlePrompt:"Please generate a concise and clear title for this document, no more than 10 words, and do not use quotes.",editTime:"Edit time",editTimeDesc:"Automatically update the edit time of the document",enableEditTime:"Enable auto update edit time",enableEditTimeDesc:"Enable to automatically update the edit time of the document",editTimeFormat:"Edit time format",editTimeFormatDesc:"Set the format of the edit time",customFieldNames:"Custom field names",customFieldNamesDesc:"Custom field names for metadata",tagsFieldName:"Tags field name",tagsFieldNameDesc:"Field name used for automatically generating tags (default: tags)",descriptionFieldName:"Description field name",descriptionFieldNameDesc:"Field name used for automatically generating descriptions (default: description)",titleFieldName:"Title field name",titleFieldNameDesc:"Field name used for automatically generating titles (default: title)",updateTimeFieldName:"Update time field name",updateTimeFieldNameDesc:"Field name used for automatically updating the update time (default: updated)",createTimeFieldName:"Create time field name",createTimeFieldNameDesc:"Field name used for automatically updating the create time (default: created)",customMetadata:"Custom metadata",customMetadataDesc:"Add custom metadata fields, e.g.: author=Author Name",addField:"Add field",fieldKey:"Field name",fieldValue:"Field value",categoryOptions:"Category",categoryOptionsDesc:"Automatically select appropriate category for articles",enableCategory:"Enable auto category",enableCategoryDesc:"Enable to automatically select category for documents",categoryFieldName:"Category field name",categoryFieldNameDesc:"Field name used for automatically generating category (default: category)",categoryList:"Category list",categoryListDesc:"Optional category list, separated by line breaks",metaCategoryPrompt:"Category prompt",metaCategoryPromptDesc:"Prompt for generating category",defaultCategoryPrompt:"Please select a suitable category for this document",categoryUnknown:"Unknown",defaultCategories:'["Travel", "Shopping", "Mood", "Book Review", "Tech & Knowledge", "Entertainment", "Papers to Read", "Ideas & Inspiration", "Todo", "Methodology", "Work Thoughts", "Investment", "Books to Read", "Personal Info", "Accounting", "Tasks", "Health", "Excerpts", "Daily Life", "Worldview", "Food"]',donate:"Donate",supportThisPlugin:"Support this plugin",supportThisPluginDesc:"If you find this plugin helpful, consider buying me a coffee!",bugMeACoffee:"Buy me a coffee",exmemoAdjustMeta:"Generate meta data"};var _={confirm:"\u786E\u8BA4",yes:"\u662F",no:"\u5426",llmLoading:"LLM \u601D\u8003\u4E2D...",noResult:"LLM \u65E0\u7ED3\u679C",pleaseOpenFile:"\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6",llmError:"LLM \u9519\u8BEF",inputPrompt:"\u8BF7\u8F93\u5165\u63D0\u793A\u8BCD",chatButton:"\u5BF9\u8BDD",pleaseSelectText:"\u8BF7\u5148\u9009\u62E9\u6587\u672C",currentFileNotMarkdown:"\u5F53\u524D\u6587\u4EF6\u4E0D\u662F markdown \u6587\u4EF6",fileAlreadyContainsTagsAndDescription:"\u6587\u4EF6\u5DF2\u7ECF\u5305\u542B\u6807\u7B7E\u548C\u63CF\u8FF0",parseError:"\u89E3\u6790\u9519\u8BEF",metaUpdated:"\u5143\u6570\u636E\u5DF2\u66F4\u65B0",noProviderSelected:"\u672A\u9009\u62E9 LLM \u63D0\u4F9B\u5546",llmSettings:"LLM",apiKey:"API \u5BC6\u94A5",baseUrl:"\u57FA\u7840 URL",modelName:"\u6A21\u578B\u540D\u79F0",apiProvider:"API \u63D0\u4F9B\u5546",apiProviderDesc:"\u914D\u7F6E\u4F60\u7684 AI \u63D0\u4F9B\u5546\u8BBE\u7F6E\u3002\u81EA\u5B9A\u4E49\u63D0\u4F9B\u5546\u9700\u8981\u989D\u5916\u914D\u7F6E\u3002",llmConfiguration:"API \u914D\u7F6E",selectApiProvider:"\u9009\u62E9 API \u63D0\u4F9B\u5546",endpoint:"\u63A5\u53E3\u8DEF\u5F84",enterEndpoint:"\u8F93\u5165\u4F60\u7684 API \u63A5\u53E3\u8DEF\u5F84",addProvider:"\u6DFB\u52A0\u63D0\u4F9B\u5546",editProvider:"\u7F16\u8F91",deleteProvider:"\u5220\u9664",providerName:"\u63D0\u4F9B\u5546\u540D\u79F0",test:"\u6D4B\u8BD5",openRouter:"OpenRouter",providerType:"\u63D0\u4F9B\u5546\u7C7B\u578B",selectProviderType:"\u9009\u62E9 LLM \u63D0\u4F9B\u5546\u7C7B\u578B",modelSelection:"\u6A21\u578B\u9009\u62E9",selectModel:"\u9009\u62E9\u8BE5\u63D0\u4F9B\u5546\u7684\u6A21\u578B",currentModel:"\u5F53\u524D\u6A21\u578B",modelOptions:"\u6A21\u578B\u9009\u9879",selectModelFromProvider:"\u4ECE\u5F53\u524D\u63D0\u4F9B\u5546\u4E2D\u9009\u62E9\u4E00\u4E2A\u6A21\u578B",currentlySelected:"\u5F53\u524D\u5DF2\u9009\u62E9",model:"\u6A21\u578B",selectTheModelToUse:"\u9009\u62E9\u8981\u4F7F\u7528\u7684\u6A21\u578B",enterYourApiKey:"\u8F93\u5165\u4F60\u7684 API \u5BC6\u94A5",show:"\u663E\u793A",hide:"\u9690\u85CF",apiConfig:"API \u914D\u7F6E",customProviderConfig:"\u81EA\u5B9A\u4E49\u63D0\u4F9B\u5546\u914D\u7F6E",baseUrlDesc:"\u8F93\u5165\u81EA\u5B9A\u4E49 API \u7684\u57FA\u7840 URL",endpointDesc:"\u8F93\u5165 API \u7684\u63A5\u53E3\u8DEF\u5F84",metaUpdateSetting:"\u66F4\u65B0\u5143\u6570\u636E",updateMetaOptions:"\u66F4\u65B0\u9009\u9879",updateMetaOptionsDesc:"\u5982\u679C\u5DF2\u7ECF\u5B58\u5728\uFF0C\u662F\u5426\u91CD\u65B0\u751F\u6210",updateForce:"\u5F3A\u5236\u66F4\u65B0",updateNoLLM:"\u53EA\u66F4\u65B0\u4E0D\u7528LLM\u7684\u9879",truncateContent:"\u5185\u5BB9\u592A\u957F\u662F\u5426\u622A\u65AD",truncateContentDesc:"\u4F7F\u7528LLM\u65F6\uFF0C\u5982\u679C\u5185\u5BB9\u8D85\u8FC7\u6700\u5927\u5B57\u6570\uFF0C\u662F\u5426\u622A\u65AD",maxContentLength:"\u6700\u5927\u5185\u5BB9\u957F\u5EA6",maxContentLengthDesc:"\u8BBE\u7F6E\u5185\u5BB9\u7684\u6700\u5927 token \u9650\u5236",truncateMethod:"\u622A\u65AD\u65B9\u5F0F",truncateMethodDesc:"\u9009\u62E9\u5185\u5BB9\u8D85\u8FC7\u9650\u5236\u65F6\u7684\u5904\u7406\u65B9\u5F0F",head_only:"\u4EC5\u63D0\u53D6\u5F00\u5934\u90E8\u5206",head_tail:"\u63D0\u53D6\u5F00\u5934\u548C\u7ED3\u5C3E\u90E8\u5206",heading:"\u63D0\u53D6\u6807\u9898\u53CA\u5176\u4E0B\u65B9\u7684\u6587\u5B57",taggingOptions:"\u6807\u7B7E",taggingOptionsDesc:"\u81EA\u52A8\u751F\u6210\u6807\u7B7E",extractTags:"\u63D0\u53D6\u6807\u7B7E",extractTagsDesc:"\u4ECE\u6240\u6709\u7B14\u8BB0\u4E2D\u63D0\u53D6\u51FA\u73B0\u8D85\u8FC7\u4E24\u6B21\u7684\u6807\u7B7E",extract:"\u63D0\u53D6",tagList:"\u6807\u7B7E\u5217\u8868",tagListDesc:"\u53EF\u9009\u6807\u7B7E\u5217\u8868\uFF0C\u4F7F\u7528\u56DE\u8F66\u5206\u9694",metaTagsPrompt:"\u6807\u7B7E\u751F\u6210\u63D0\u793A\u8BCD",metaTagsPromptDesc:"\u7528\u4E8E\u751F\u6210\u6807\u7B7E\u7684\u63D0\u793A\u8BCD\uFF0C\u53EF\u5728\u6B64\u8BBE\u7F6E\u8BED\u8A00\u3001\u5927\u5C0F\u5199\u7B49",defaultTagsPrompt:"\u8BF7\u63D0\u53D6\u8FD9\u7BC7\u6587\u7AE0\u4E2D\u6700\u5408\u9002\u7684\u4E0D\u8D85\u8FC7\u4E09\u4E2A\u6807\u7B7E\uFF0C\u5E76\u4F7F\u7528\u4E0E\u5185\u5BB9\u76F8\u540C\u7684\u8BED\u8A00\u3002",description:"\u63CF\u8FF0",descriptionDesc:"\u81EA\u52A8\u751F\u6210\u6587\u7AE0\u63CF\u8FF0",descriptionPrompt:"\u63CF\u8FF0\u63D0\u793A\u8BCD",descriptionPromptDesc:"\u7528\u4E8E\u751F\u6210\u63CF\u8FF0\u7684\u63D0\u793A\u8BCD",defaultSummaryPrompt:"\u76F4\u63A5\u603B\u7ED3\u6587\u7AE0\u7684\u6838\u5FC3\u5185\u5BB9\uFF0C\u4E0D\u8981\u4F7F\u7528'\u8FD9\u7BC7\u6587\u7AE0'\u8FD9\u6837\u7684\u77ED\u8BED\uFF0C\u4E0D\u8D85\u8FC750\u4E2A\u5B57\uFF0C\u4E14\u4E0E\u5185\u5BB9\u4F7F\u7528\u76F8\u540C\u8BED\u8A00\u56DE\u7B54\u3002",title:"\u6807\u9898",titleDesc:"\u81EA\u52A8\u751F\u6210\u6587\u6863\u6807\u9898",enableTitle:"\u542F\u7528\u81EA\u52A8\u751F\u6210\u6807\u9898",enableTitleDesc:"\u542F\u7528\u540E\u5C06\u81EA\u52A8\u751F\u6210\u6587\u6863\u6807\u9898",titlePrompt:"\u6807\u9898\u751F\u6210\u63D0\u793A\u8BCD",titlePromptDesc:"\u7528\u4E8E\u751F\u6210\u6807\u9898\u7684\u63D0\u793A\u8BCD",defaultTitlePrompt:"\u8BF7\u4E3A\u8FD9\u7BC7\u6587\u6863\u751F\u6210\u4E00\u4E2A\u7B80\u6D01\u660E\u4E86\u7684\u6807\u9898\uFF0C\u4E0D\u8D85\u8FC710\u4E2A\u5B57\uFF0C\u4E0D\u8981\u4F7F\u7528\u5F15\u53F7\u3002",editTime:"\u7F16\u8F91\u65F6\u95F4",editTimeDesc:"\u81EA\u52A8\u66F4\u65B0\u6587\u6863\u7F16\u8F91\u65F6\u95F4",enableEditTime:"\u542F\u7528\u81EA\u52A8\u66F4\u65B0\u7F16\u8F91\u65F6\u95F4",enableEditTimeDesc:"\u542F\u7528\u540E\u5C06\u81EA\u52A8\u66F4\u65B0\u6587\u6863\u7684\u7F16\u8F91\u65F6\u95F4",editTimeFormat:"\u65F6\u95F4\u683C\u5F0F",editTimeFormatDesc:"\u7F16\u8F91\u65F6\u95F4\u7684\u683C\u5F0F\uFF0C\u4F7F\u7528 moment.js \u683C\u5F0F",customFieldNames:"\u81EA\u5B9A\u4E49\u5B57\u6BB5\u540D",customFieldNamesDesc:"\u81EA\u5B9A\u4E49\u751F\u6210\u7684\u5143\u6570\u636E\u5B57\u6BB5\u540D\u79F0",tagsFieldName:"\u6807\u7B7E\u5B57\u6BB5\u540D",tagsFieldNameDesc:"\u81EA\u52A8\u751F\u6210\u6807\u7B7E\u4F7F\u7528\u7684\u5B57\u6BB5\u540D (\u9ED8\u8BA4: tags)",descriptionFieldName:"\u63CF\u8FF0\u5B57\u6BB5\u540D",descriptionFieldNameDesc:"\u81EA\u52A8\u751F\u6210\u63CF\u8FF0\u4F7F\u7528\u7684\u5B57\u6BB5\u540D (\u9ED8\u8BA4: description)",titleFieldName:"\u6807\u9898\u5B57\u6BB5\u540D",titleFieldNameDesc:"\u81EA\u52A8\u751F\u6210\u6807\u9898\u4F7F\u7528\u7684\u5B57\u6BB5\u540D (\u9ED8\u8BA4: title)",updateTimeFieldName:"\u66F4\u65B0\u65F6\u95F4\u5B57\u6BB5\u540D",updateTimeFieldNameDesc:"\u81EA\u52A8\u66F4\u65B0\u7F16\u8F91\u65F6\u95F4\u4F7F\u7528\u7684\u5B57\u6BB5\u540D (\u9ED8\u8BA4: updated)",createTimeFieldName:"\u521B\u5EFA\u65F6\u95F4\u5B57\u6BB5\u540D",createTimeFieldNameDesc:"\u81EA\u52A8\u751F\u6210\u521B\u5EFA\u65F6\u95F4\u4F7F\u7528\u7684\u5B57\u6BB5\u540D (\u9ED8\u8BA4: created)",customMetadata:"\u81EA\u5B9A\u4E49\u5143\u6570\u636E",customMetadataDesc:"\u6DFB\u52A0\u81EA\u5B9A\u4E49\u7684\u5143\u6570\u636E\u5B57\u6BB5\uFF0C\u5982\uFF1Aauthor=\u4F5C\u8005\u540D",addField:"\u6DFB\u52A0\u5B57\u6BB5",fieldKey:"\u5B57\u6BB5\u540D",fieldValue:"\u5B57\u6BB5\u503C",categoryOptions:"\u7C7B\u522B",categoryOptionsDesc:"\u81EA\u52A8\u4E3A\u6587\u7AE0\u9009\u62E9\u5408\u9002\u7684\u7C7B\u522B",enableCategory:"\u542F\u7528\u81EA\u52A8\u5206\u7C7B",enableCategoryDesc:"\u542F\u7528\u540E\u5C06\u81EA\u52A8\u4E3A\u6587\u6863\u9009\u62E9\u7C7B\u522B",categoryFieldName:"\u7C7B\u522B\u5B57\u6BB5\u540D",categoryFieldNameDesc:"\u81EA\u52A8\u751F\u6210\u7C7B\u522B\u4F7F\u7528\u7684\u5B57\u6BB5\u540D (\u9ED8\u8BA4: category)",categoryList:"\u7C7B\u522B\u5217\u8868",categoryListDesc:"\u53EF\u9009\u7C7B\u522B\u5217\u8868\uFF0C\u4F7F\u7528\u56DE\u8F66\u5206\u9694",metaCategoryPrompt:"\u7C7B\u522B\u751F\u6210\u63D0\u793A\u8BCD",metaCategoryPromptDesc:"\u7528\u4E8E\u751F\u6210\u7C7B\u522B\u7684\u63D0\u793A\u8BCD",defaultCategoryPrompt:"\u8BF7\u4E3A\u8FD9\u7BC7\u6587\u6863\u9009\u62E9\u4E00\u4E2A\u5408\u9002\u7684\u7C7B\u522B",categoryUnknown:"\u672A\u5206\u7C7B",defaultCategories:'["\u65C5\u884C", "\u8D2D\u7269", "\u5FC3\u60C5", "\u8BFB\u540E\u611F", "\u77E5\u8BC6\u79D1\u6280", "\u5A31\u4E50", "\u5F85\u8BFB\u8BBA\u6587", "\u7075\u611F\u521B\u610F", "\u5F85\u529E\u4E8B\u9879", "\u65B9\u6CD5\u8BBA", "\u5DE5\u4F5C\u601D\u8003", "\u6295\u8D44", "\u5F85\u8BFB\u4E66", "\u4E2A\u4EBA\u4FE1\u606F", "\u8BB0\u5E10", "\u5F85\u505A", "\u5065\u5EB7", "\u6458\u5F55", "\u65E5\u5E38\u7410\u4E8B", "\u4E16\u754C\u89C2", "\u7F8E\u98DF"]',donate:"\u6350\u8D60",supportThisPlugin:"\u652F\u6301\u6B64\u63D2\u4EF6",supportThisPluginDesc:"\u5982\u679C\u60A8\u559C\u6B22\u8FD9\u4E2A\u63D2\u4EF6\uFF0C\u53EF\u4EE5\u8BF7\u6211\u559D\u676F\u5496\u5561",bugMeACoffee:"\u8BF7\u6211\u559D\u676F\u5496\u5561",exmemoAdjustMeta:"\u751F\u6210\u5143\u6570\u636E"};var ee={en:O,"zh-cn":_},R=ee[W.moment.locale()];function e(c){return R&&R[c]||O[c]}var F=[{id:"Pro/deepseek-ai/DeepSeek-R1",name:"DeepSeek-R1"},{id:"Pro/deepseek-ai/DeepSeek-V3",name:"Deepseek-V3"},{id:"Qwen/QwQ-32B",name:"Qwen"}],S=[{id:"openai/o1",name:"OpenAI: o1"},{id:"openai/chatgpt-4o-latest",name:"ChatGPT-4o"},{id:"anthropic/claude-3.7-sonnet",name:"claude-3.7-sonnet"},{id:"google/gemini-2.0-flash-001",name:"Gemini Flash 2.0"}],v={llmProviders:[{id:"siliconflow",name:"\u7845\u57FA\u6D41\u52A8",type:"siliconflow",baseUrl:"https://api.siliconflow.cn",token:"sk-",modelName:"deepseek-r1",models:F,endpoint:"/v1/chat/completions"},{id:"openrouter",name:"OpenRouter",type:"openrouter",baseUrl:"https://openrouter.ai/api",token:"sk-",modelName:"openai/gpt-4o",models:S,endpoint:"/v1/chat/completions"},{id:"custom",name:"\u81EA\u5B9A\u4E49",type:"custom",baseUrl:"https://api.example.com",token:"sk-",modelName:"custom-model",models:[{id:"custom-model",name:"\u81EA\u5B9A\u4E49\u6A21\u578B"}],endpoint:"/v1/chat/completions"}],currentLLMProvider:"siliconflow",llmPrompts:{},llmDialogEdit:!1,tags:[],metaIsTruncate:!0,metaMaxTokens:1e3,metaTruncateMethod:"head_only",metaUpdateMethod:"no-llm",metaDescription:e("defaultSummaryPrompt"),metaTitleEnabled:!0,metaTitlePrompt:e("defaultTitlePrompt"),metaEditTimeEnabled:!0,metaEditTimeFormat:"YYYY-MM-DD HH:mm:ss",selectExcludedFolders:[],metaTagsFieldName:"tags",metaDescriptionFieldName:"description",metaTitleFieldName:"title",metaUpdatedFieldName:"updated",metaCreatedFieldName:"created",metaTagsPrompt:e("defaultTagsPrompt"),customMetadata:[],metaCategoryFieldName:"category",categories:JSON.parse(e("defaultCategories")),metaCategoryPrompt:e("defaultCategoryPrompt"),metaCategoryEnabled:!0};var d=require("obsidian");var C=require("obsidian");async function H(c,r){let s="",i=new C.Notice(e("llmLoading"),0);try{let l=r.currentLLMProvider,g=r.llmProviders.find(m=>m.id===l);if(!g)throw new Error(e("noProviderSelected"));let a=g.baseUrl||"",o=g.endpoint||"";a.endsWith("/v1/")?a=a.substring(0,a.length-4):a.endsWith("/v1")&&(a=a.substring(0,a.length-3)),a.endsWith("/")&&(a=a.substring(0,a.length-1)),o.startsWith("/")||(o="/"+o),o.includes("/v1/chat/completions")&&a.includes("/v1/chat/completions")&&(o="");let f=a+o;console.log("API URL:",f);let u=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g.token}`},mode:"cors",body:JSON.stringify({model:g.modelName,messages:[{role:"user",content:c}]})});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);let h=await u.json();h.choices&&h.choices.length>0&&(s=h.choices[0].message.content||s)}catch(l){new C.Notice(e("llmError")+`
`+l),console.warn("Error:",l)}return i.hide(),s}function U(c){let r=/[\u4e00-\u9fa5]|[a-zA-Z0-9]+|[\.,!?;，。！？；#]|[\n]/g;return c.match(r)||[]}function L(c){let r="";for(let s=0;s<c.length;s++){let i=c[s];i===`
`||/[\u4e00-\u9fa5]|[\.,!?;，。！？；#]/.test(i)?r+=i:r+=(s>0?" ":"")+i}return r.trim()}async function j(c){let r={};return c.vault.getMarkdownFiles().forEach(s=>{let i=c.metadataCache.getFileCache(s);if(i){let l=(0,C.getAllTags)(i);l&&l.forEach(g=>{let a=g;a.startsWith("#")&&(a=a.slice(1)),r[a]?r[a]++:r[a]=1})}}),r}async function I(c,r,s=1e3,i="head_only"){var a;let l="";if(r!==null)l=await c.vault.read(r);else{let o=(a=c.workspace.getActiveViewOfType(C.MarkdownView))==null?void 0:a.editor;if(!o)return"";l=o.getSelection(),l=l.trim(),l.length===0&&(l=o.getValue())}if(l.length===0)return"";let g=U(l);if(g.length>s&&s>0){if(i==="head_tail"){let o=Math.round(s*.8),f=Math.round(s*.2),u=g.slice(0,o),h=g.slice(-f);l=L(u)+`
...
`+L(h)}else if(i==="head_only")l=L(g.slice(0,s))+"...";else if(i==="heading"){let o=l.split(`
`);o=o.filter(m=>m.trim()!=="");let f=[],u=!1;for(let m of o)if(m.startsWith("#"))f.push(m),u=!0;else if(u&&m.trim()!==""){let T=U(m);f.push(L(T.slice(0,30))+"..."),u=!1}l=f.join(`
`);let h=U(l);if(h.length>s)l=L(h.slice(0,s));else{let m=s-h.length,T=L(g.slice(0,m))+"...";l=`Outline: 
${l}

Body: ${T}`}}}return l}function N(c,r,s,i,l){r.fileManager.processFrontMatter(c,g=>{if(i!=null)if(l==="append"){let a=g[s];if(typeof i=="string")a==null&&(a=""),g[s]=a+i;else if(Array.isArray(i)){(a==null||!Array.isArray(a))&&(a=[]);let o=a.concat(i),f=Array.from(new Set(o));g[s]=f}}else if(l==="update")g[s]=i;else{let a=g[s];if(a!=null)return;g[s]=i}})}var x=class extends d.PluginSettingTab{constructor(s,i){super(s,i);this.plugin=i}display(){let s,{containerEl:i}=this;i.empty(),new d.Setting(i).setName(e("apiProvider")).setDesc(e("apiProviderDesc")).setHeading();let l=new d.Setting(i).setName(e("apiConfig")).setDesc(e("selectApiProvider")),g=new d.DropdownComponent(l.controlEl);v.llmProviders.forEach(t=>{g.addOption(t.id,t.name)}),v.llmProviders.map(t=>t.id).includes(this.plugin.settings.currentLLMProvider)||(this.plugin.settings.currentLLMProvider=v.currentLLMProvider),g.setValue(this.plugin.settings.currentLLMProvider),g.onChange(async t=>{if(this.plugin.settings.currentLLMProvider=t,this.plugin.settings.llmProviders.findIndex(p=>p.id===t)===-1){let p=v.llmProviders.find(w=>w.id===t);p&&this.plugin.settings.llmProviders.push({...p})}await this.plugin.saveSettings(),this.display()});let o=this.plugin.settings.llmProviders.find(t=>t.id===this.plugin.settings.currentLLMProvider);if(!o){let t=v.llmProviders.find(n=>n.id===this.plugin.settings.currentLLMProvider);o=t?{...t}:{...v.llmProviders[0]},this.plugin.settings.llmProviders.push(o),this.plugin.settings.currentLLMProvider=o.id,this.plugin.saveSettings()}if(o.id==="siliconflow"||o.id==="openrouter"){let t=o.baseUrl||"",n=o.endpoint||"";t.endsWith("/v1/")?t=t.substring(0,t.length-4):t.endsWith("/v1")&&(t=t.substring(0,t.length-3)),t.endsWith("/")&&(t=t.substring(0,t.length-1)),n.startsWith("/")||(n="/"+n),n.includes("/v1/chat/completions")&&t.includes("/v1/chat/completions")&&(n="");let p=t+n;new d.Setting(i).setName(o.name).setDesc(p)}else if(o.id==="custom"){new d.Setting(i).setName(e("customProviderConfig")).setHeading();let t=new d.Setting(i).setName(e("baseUrl")).setDesc(e("baseUrlDesc")),n=new d.TextComponent(t.controlEl);n.inputEl.placeholder="https://api.example.com",n.inputEl.value=o.baseUrl||"",n.onChange(async P=>{let y=this.plugin.settings.llmProviders.findIndex(D=>D.id===o.id);y!==-1&&(this.plugin.settings.llmProviders[y].baseUrl=P,await this.plugin.saveSettings())});let p=new d.Setting(i).setName(e("endpoint")).setDesc(e("endpointDesc")),w=new d.TextComponent(p.controlEl);w.inputEl.placeholder="/v1/chat/completions",w.inputEl.value=o.endpoint||"",w.onChange(async P=>{let y=this.plugin.settings.llmProviders.findIndex(D=>D.id===o.id);y!==-1&&(this.plugin.settings.llmProviders[y].endpoint=P,await this.plugin.saveSettings())})}let f=new d.Setting(i).setName(e("apiKey")).setDesc(e("enterYourApiKey")),u=new d.TextComponent(f.controlEl);u.inputEl.type="password",u.inputEl.value=o.token||"",u.onChange(async t=>{let n=this.plugin.settings.llmProviders.findIndex(p=>p.id===o.id);n!==-1&&(this.plugin.settings.llmProviders[n].token=t,await this.plugin.saveSettings())}),f.addButton(t=>t.setButtonText(e("show")).onClick(()=>{u.inputEl.type==="password"?(u.inputEl.type="text",t.setButtonText(e("hide"))):(u.inputEl.type="password",t.setButtonText(e("show")))})).addButton(t=>t.setButtonText(e("test")).onClick(async()=>{try{let n=o.baseUrl||"",p=o.endpoint||"";n.endsWith("/v1/")?n=n.substring(0,n.length-4):n.endsWith("/v1")&&(n=n.substring(0,n.length-3)),n.endsWith("/")&&(n=n.substring(0,n.length-1)),p.startsWith("/")||(p="/"+p),p.includes("/v1/chat/completions")&&n.includes("/v1/chat/completions")&&(p="");let w=n+p;console.log("Test URL:",w);let P=new d.Notice(e("llmLoading"),0);try{let y=await fetch(w,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.token}`},mode:"cors",body:JSON.stringify({model:o.modelName,messages:[{role:"user",content:"Hello, please respond with 'Test successful'"}]})});if(!y.ok)throw new Error(`HTTP error! status: ${y.status}`);let D=await y.json();if(D.choices&&D.choices.length>0){let q=D.choices[0].message.content;P.hide(),new d.Notice(`Test result: ${q}`)}else throw new Error("No response from the API")}catch(y){P.hide(),new d.Notice(`Test failed: ${y.message}`)}}catch(n){new d.Notice(`Test failed: ${n.message}`)}}));let h=new d.Setting(i).setName(e("model")).setDesc(e("selectTheModelToUse")),m=new d.DropdownComponent(h.controlEl);o.models.forEach(t=>{m.addOption(t.id,t.name)}),m.setValue(o.modelName),m.onChange(async t=>{let n=this.plugin.settings.llmProviders.findIndex(p=>p.id===o.id);n!==-1&&(this.plugin.settings.llmProviders[n].modelName=t,await this.plugin.saveSettings())}),new d.Setting(i).setName(e("metaUpdateSetting")).setHeading(),new d.Setting(i).setName(e("updateMetaOptions")).setDesc(e("updateMetaOptionsDesc")).setClass("setting-item-nested").addDropdown(t=>{t.addOption("force",e("updateForce")).addOption("no-llm",e("updateNoLLM")).setValue(this.plugin.settings.metaUpdateMethod).onChange(async n=>{this.plugin.settings.metaUpdateMethod=n,await this.plugin.saveSettings()})});let T=new d.Setting(i).setName(e("truncateContent")).setDesc(e("truncateContentDesc")).setClass("setting-item-nested").addToggle(t=>{t.setValue(this.plugin.settings.metaIsTruncate).onChange(async n=>{this.plugin.settings.metaIsTruncate=n,await this.plugin.saveSettings(),b.setDisabled(!n),M.setDisabled(!n)})}),M=new d.Setting(i).setName(e("maxContentLength")).setDesc(e("maxContentLengthDesc")).setClass("setting-item-nested-2").addText(t=>{t.setValue(this.plugin.settings.metaMaxTokens.toString()).onChange(async n=>{this.plugin.settings.metaMaxTokens=parseInt(n),await this.plugin.saveSettings()})}),b=new d.Setting(i).setName(e("truncateMethod")).setDesc(e("truncateMethodDesc")).setClass("setting-item-nested-2").addDropdown(t=>{t.addOption("head_only",e("head_only")).addOption("head_tail",e("head_tail")).addOption("heading",e("heading")).setValue(this.plugin.settings.metaTruncateMethod).onChange(async n=>{this.plugin.settings.metaTruncateMethod=n,await this.plugin.saveSettings()})});T&&(b.setDisabled(!this.plugin.settings.metaIsTruncate),M.setDisabled(!this.plugin.settings.metaIsTruncate)),new d.Setting(i).setName(e("taggingOptions")).setDesc(e("taggingOptionsDesc")).setHeading().setClass("setting-item-nested"),new d.Setting(i).setName(e("tagsFieldName")).setDesc(e("tagsFieldNameDesc")).setClass("setting-item-nested").addText(t=>t.setValue(this.plugin.settings.metaTagsFieldName).onChange(async n=>{this.plugin.settings.metaTagsFieldName=n||"tags",await this.plugin.saveSettings()})),new d.Setting(i).setName(e("extractTags")).setDesc(e("extractTagsDesc")).setClass("setting-item-nested").addButton(t=>{t.setButtonText(e("extract")).setCta().onClick(async()=>{let n=await j(this.app),w=Object.entries(n).sort((y,D)=>D[1]-y[1]).filter(([y,D])=>D>2).map(([y])=>y),P=this.plugin.settings.tags;for(let y of w)P.includes(y)||P.push(y);this.plugin.settings.tags=P,s.setValue(this.plugin.settings.tags.join(`
`))})}),new d.Setting(i).setName(e("tagList")).setDesc(e("tagListDesc")).setClass("setting-item-nested").addTextArea(t=>{s=t,t.setValue(this.plugin.settings.tags.join(`
`)).onChange(async n=>{this.plugin.settings.tags=n.split(`
`).map(p=>p.trim()).filter(p=>p!==""),await this.plugin.saveSettings()}),t.inputEl.setAttr("rows","7"),t.inputEl.addClass("setting-textarea")}),new d.Setting(i).setName(e("metaTagsPrompt")).setDesc(e("metaTagsPromptDesc")).setClass("setting-item-nested").addTextArea(t=>{t.setPlaceholder(this.plugin.settings.metaTagsPrompt).setValue(this.plugin.settings.metaTagsPrompt).onChange(async n=>{this.plugin.settings.metaTagsPrompt=n,await this.plugin.saveSettings()}),t.inputEl.setAttr("rows","3"),t.inputEl.addClass("setting-textarea")}),new d.Setting(i).setName(e("categoryOptions")).setDesc(e("categoryOptionsDesc")).setHeading().setClass("setting-item-nested"),new d.Setting(i).setName(e("enableCategory")).setDesc(e("enableCategoryDesc")).setClass("setting-item-nested").addToggle(t=>t.setValue(this.plugin.settings.metaCategoryEnabled).onChange(async n=>{this.plugin.settings.metaCategoryEnabled=n,await this.plugin.saveSettings()})),new d.Setting(i).setName(e("categoryFieldName")).setDesc(e("categoryFieldNameDesc")).setClass("setting-item-nested").addText(t=>t.setValue(this.plugin.settings.metaCategoryFieldName).onChange(async n=>{this.plugin.settings.metaCategoryFieldName=n||"category",await this.plugin.saveSettings()})),new d.Setting(i).setName(e("categoryList")).setDesc(e("categoryListDesc")).setClass("setting-item-nested").addTextArea(t=>{t.setValue(this.plugin.settings.categories.join(`
`)).onChange(async n=>{this.plugin.settings.categories=n.split(`
`).map(p=>p.trim()).filter(p=>p!==""),await this.plugin.saveSettings()}),t.inputEl.setAttr("rows","5"),t.inputEl.addClass("setting-textarea")}),new d.Setting(i).setName(e("metaCategoryPrompt")).setDesc(e("metaCategoryPromptDesc")).setClass("setting-item-nested").addTextArea(t=>{t.setPlaceholder(this.plugin.settings.metaCategoryPrompt).setValue(this.plugin.settings.metaCategoryPrompt).onChange(async n=>{this.plugin.settings.metaCategoryPrompt=n,await this.plugin.saveSettings()}),t.inputEl.setAttr("rows","3"),t.inputEl.addClass("setting-textarea")}),new d.Setting(i).setName(e("description")).setDesc(e("descriptionDesc")).setHeading().setClass("setting-item-nested"),new d.Setting(i).setName(e("descriptionFieldName")).setDesc(e("descriptionFieldNameDesc")).setClass("setting-item-nested").addText(t=>t.setValue(this.plugin.settings.metaDescriptionFieldName).onChange(async n=>{this.plugin.settings.metaDescriptionFieldName=n||"description",await this.plugin.saveSettings()})),new d.Setting(i).setName(e("descriptionPrompt")).setDesc(e("descriptionPromptDesc")).setClass("setting-item-nested").addTextArea(t=>{t.setValue(this.plugin.settings.metaDescription).onChange(async n=>{this.plugin.settings.metaDescription=n,await this.plugin.saveSettings()}),t.inputEl.setAttr("rows","3"),t.inputEl.addClass("setting-textarea")}),new d.Setting(i).setName(e("title")).setDesc(e("titleDesc")).setHeading().setClass("setting-item-nested"),new d.Setting(i).setName(e("titleFieldName")).setDesc(e("titleFieldNameDesc")).setClass("setting-item-nested").addText(t=>t.setValue(this.plugin.settings.metaTitleFieldName).onChange(async n=>{this.plugin.settings.metaTitleFieldName=n||"title",await this.plugin.saveSettings()})),new d.Setting(i).setName(e("enableTitle")).setDesc(e("enableTitleDesc")).setClass("setting-item-nested").addToggle(t=>{t.setValue(this.plugin.settings.metaTitleEnabled).onChange(async n=>{this.plugin.settings.metaTitleEnabled=n,await this.plugin.saveSettings(),V.setDisabled(!n)})});let V=new d.Setting(i).setName(e("titlePrompt")).setDesc(e("titlePromptDesc")).setClass("setting-item-nested").addTextArea(t=>{t.setValue(this.plugin.settings.metaTitlePrompt).onChange(async n=>{this.plugin.settings.metaTitlePrompt=n,await this.plugin.saveSettings()}),t.inputEl.setAttr("rows","3"),t.inputEl.addClass("setting-textarea")});V.setDisabled(!this.plugin.settings.metaTitleEnabled),new d.Setting(i).setName(e("editTime")).setDesc(e("editTimeDesc")).setHeading().setClass("setting-item-nested"),new d.Setting(i).setName(e("updateTimeFieldName")).setDesc(e("updateTimeFieldNameDesc")).setClass("setting-item-nested").addText(t=>t.setValue(this.plugin.settings.metaUpdatedFieldName).onChange(async n=>{this.plugin.settings.metaUpdatedFieldName=n||"updated",await this.plugin.saveSettings()})),new d.Setting(i).setName(e("createTimeFieldName")).setDesc(e("createTimeFieldNameDesc")).setClass("setting-item-nested").addText(t=>t.setValue(this.plugin.settings.metaCreatedFieldName).onChange(async n=>{this.plugin.settings.metaCreatedFieldName=n||"created",await this.plugin.saveSettings()})),new d.Setting(i).setName(e("enableEditTime")).setDesc(e("enableEditTimeDesc")).setClass("setting-item-nested").addToggle(t=>{t.setValue(this.plugin.settings.metaEditTimeEnabled).onChange(async n=>{this.plugin.settings.metaEditTimeEnabled=n,await this.plugin.saveSettings(),B.setDisabled(!n)})});let B=new d.Setting(i).setName(e("editTimeFormat")).setDesc(e("editTimeFormatDesc")).setClass("setting-item-nested").addText(t=>{t.setValue(this.plugin.settings.metaEditTimeFormat).setPlaceholder("YYYY-MM-DD HH:mm:ss").onChange(async n=>{this.plugin.settings.metaEditTimeFormat=n,await this.plugin.saveSettings()})});B.setDisabled(!this.plugin.settings.metaEditTimeEnabled),new d.Setting(i).setName(e("customMetadata")).setDesc(e("customMetadataDesc")).setHeading().setClass("setting-item-nested").addButton(t=>t.setButtonText(e("addField")).onClick(async()=>{this.plugin.settings.customMetadata.push({key:"",value:""}),await this.plugin.saveSettings(),this.display()})),this.plugin.settings.customMetadata.forEach((t,n)=>{let p=new d.Setting(i).addText(w=>w.setPlaceholder(e("fieldKey")).setValue(t.key).onChange(async P=>{this.plugin.settings.customMetadata[n].key=P,await this.plugin.saveSettings()})).addText(w=>w.setPlaceholder(e("fieldValue")).setValue(t.value).onChange(async P=>{this.plugin.settings.customMetadata[n].value=P,await this.plugin.saveSettings()})).addButton(w=>w.setIcon("trash").onClick(async()=>{this.plugin.settings.customMetadata.splice(n,1),await this.plugin.saveSettings(),this.display()}))}),new d.Setting(i).setName(e("donate")).setHeading(),new d.Setting(i).setName(e("supportThisPlugin")).setDesc(e("supportThisPluginDesc")).addButton(t=>{t.setButtonText(e("bugMeACoffee")).setCta().onClick(()=>{window.open("https://buymeacoffee.com/xieyan0811y","_blank")})})}};var E=require("obsidian");async function $(c,r){var o,f,u,h;let s=c.workspace.getActiveFile();if(!s){new E.Notice(e("pleaseOpenFile"));return}if(s.extension!=="md"){new E.Notice(e("currentFileNotMarkdown"));return}let i=c.metadataCache.getFileCache(s),l=(i==null?void 0:i.frontmatter)||{},g=!1,a=r.metaUpdateMethod==="force";if((!l[r.metaTagsFieldName]||((o=l[r.metaTagsFieldName])==null?void 0:o.length)===0||!l[r.metaDescriptionFieldName]||((f=l[r.metaDescriptionFieldName])==null?void 0:f.trim())===""||r.metaTitleEnabled&&(!l[r.metaTitleFieldName]||((u=l[r.metaTitleFieldName])==null?void 0:u.trim())==="")||r.metaCategoryEnabled&&(!l[r.metaCategoryFieldName]||((h=l[r.metaCategoryFieldName])==null?void 0:h.trim())==="")||a)&&(await te(s,c,r,l,a),g=!0),r.metaEditTimeEnabled)try{let m=new Date,T=Y(m,r.metaEditTimeFormat);N(s,c,r.metaUpdatedFieldName,T,"update");let M=new Date(s.stat.ctime),b=Y(M,"YYYY-MM-DD");N(s,c,r.metaCreatedFieldName,b,"update"),g=!0}catch(m){console.error("\u66F4\u65B0\u65F6\u95F4\u5143\u6570\u636E\u65F6\u51FA\u9519:",m),new E.Notice(e("llmError")+": "+m)}if(r.customMetadata&&r.customMetadata.length>0){for(let m of r.customMetadata)if(m.key&&m.value){let T=m.value;(m.value.toLowerCase()==="true"||m.value.toLowerCase()==="false")&&(T=m.value.toLowerCase()==="true"),N(s,c,m.key,T,a?"update":"keep")}g=!0}g&&new E.Notice(e("metaUpdated"))}async function te(c,r,s,i,l=!1){let g="";s.metaIsTruncate?g=await I(r,null,s.metaMaxTokens,s.metaTruncateMethod):g=await I(r,null,-1,"");let a=s.tags.join(","),o=s.categories.join(",");o===""&&(o=e("categoryUnknown"));let f=`I need to generate tags, category, description, and title for the following article. Requirements:

1. Tags: ${s.metaTagsPrompt}
   Available tags: ${a}. Feel free to create new ones if none are suitable.

2. Category: ${s.metaCategoryPrompt}
   Available categories: ${o}. Must choose ONE from the available categories.

3. Description: ${s.metaDescription}

4. Title: ${s.metaTitlePrompt}

Please return in the following JSON format:
{
    "tags": "tag1,tag2,tag3",
    "category": "category_name",
    "description": "brief summary",
    "title": "article title"
}

Article content:

${g}`,u=await H(f,s);if(u===""||u===void 0||u===null)return;u=u.replace(/`/g,"");let h={};try{let m=u.match(/{[^]*}/);m&&(h=JSON.parse(m[0]))}catch(m){new E.Notice(e("parseError")+`
`+m),console.error("parseError:",m);return}if(h.tags){let m=h.tags.split(",");N(c,r,s.metaTagsFieldName,m,"append")}if(h.category&&s.metaCategoryEnabled){let m=i[s.metaCategoryFieldName],T=!m||m.trim()==="";N(c,r,s.metaCategoryFieldName,h.category,l||T?"update":"keep")}if(h.description){let m=i[s.metaDescriptionFieldName],T=!m||m.trim()==="";N(c,r,s.metaDescriptionFieldName,h.description,l||T?"update":"keep")}if(s.metaTitleEnabled&&h.title){let m=h.title.trim();(m.startsWith('"')&&m.endsWith('"')||m.startsWith("'")&&m.endsWith("'"))&&(m=m.substring(1,m.length-1));let T=i[s.metaTitleFieldName],M=!T||T.trim()==="";N(c,r,s.metaTitleFieldName,m,l||M?"update":"keep")}}function Y(c,r){let s=c.getFullYear(),i=String(c.getMonth()+1).padStart(2,"0"),l=String(c.getDate()).padStart(2,"0"),g=String(c.getHours()).padStart(2,"0"),a=String(c.getMinutes()).padStart(2,"0"),o=String(c.getSeconds()).padStart(2,"0");return r.replace("YYYY",s.toString()).replace("MM",i).replace("DD",l).replace("HH",g).replace("mm",a).replace("ss",o)}var A=class extends K.Plugin{async onload(){await this.loadSettings(),this.addCommand({id:"adjust-meta",name:e("exmemoAdjustMeta"),editorCallback:(s,i)=>{$(this.app,this.settings)}}),this.addSettingTab(new x(this.app,this))}onunload(){}async loadSettings(){let s=await this.loadData();if(this.settings=Object.assign({},v,s),s){let i=s;if(i.llmBaseUrl!==void 0||i.llmToken!==void 0||i.llmModelName!==void 0){if(!s.llmProviders||s.llmProviders.length===0){if(console.log("Migrating from old LLM settings format to new providers format"),this.settings.llmProviders=[...v.llmProviders],i.llmBaseUrl&&i.llmToken){let l=i.llmBaseUrl.toLowerCase(),g="";if(l.includes("siliconflow")||l.includes("\u7845\u57FA"))g="siliconflow";else if(l.includes("openrouter"))g="openrouter";else{g="custom";let o=this.settings.llmProviders.find(f=>f.id==="custom");o&&(o.baseUrl=this.cleanBaseUrl(i.llmBaseUrl),i.llmModelName&&(o.modelName=i.llmModelName))}let a=this.settings.llmProviders.find(o=>o.id===g);a&&(a.token=i.llmToken,this.settings.currentLLMProvider=g)}await this.saveSettings()}delete i.llmBaseUrl,delete i.llmToken,delete i.llmModelName,await this.saveData(i)}if(s.llmProviders&&s.llmProviders.length>0){let l=!1;for(let g=0;g<this.settings.llmProviders.length;g++){let a=this.settings.llmProviders[g];if(!a.type){if(a.baseUrl){let o=a.baseUrl.toLowerCase();o.includes("siliconflow")||o.includes("\u7845\u57FA")?a.type="siliconflow":o.includes("openrouter")?a.type="openrouter":a.type="custom"}else a.type="custom";l=!0}(!a.models||a.models.length===0)&&(a.type==="siliconflow"?a.models=[...F]:a.type==="openrouter"?a.models=[...S]:a.models=[{id:"custom-model",name:"\u81EA\u5B9A\u4E49\u6A21\u578B"}],l=!0)}l&&await this.saveSettings()}}}cleanBaseUrl(s){return s?s.endsWith("/v1/")?s.substring(0,s.length-4):s.endsWith("/v1")?s.substring(0,s.length-3):s.endsWith("/")?s.substring(0,s.length-1):s:""}async saveSettings(){await this.saveData(this.settings)}};
